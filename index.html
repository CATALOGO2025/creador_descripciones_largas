<!DOCTYPE html>

<html lang="es">
<head><link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&amp;display=swap" rel="stylesheet"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Creador de Descripciones Largas</title>
<style>
    body {
      font-family: 'Roboto', 'Helvetica Neue', sans-serif;
  line-height: 1.6;
      margin: 0;
      padding: 0;
      background-color: #f8f9fa;
      font-size: 15px;
    }
    .header {
      background-color: #0056b3;
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
    }
    .container {
      max-width: 900px;
      margin: 30px auto;
      padding: 0 20px;
    }
    .attribute-group {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      margin-bottom: 20px;
      border: 1px solid #ddd;
    }
    .form-unitario-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    .full-width {
      grid-column: 1 / -1;
    }
    label {
      font-weight: bold;
      font-size: 14px;
      margin-bottom: 4px;
      display: block;
      color: #333;
    }
    input::placeholder {
      font-style: italic;
      color: #999;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 4px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-family: inherit;
      font-size: 14px;
    }
    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    button {
      background-color: #555;
      color: white;
      border: none;
      padding: 8px 14px;
      font-size: 13px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      text-transform: capitalize;
    }
    button:hover {
      background-color: #333;
    }
    .categoria-export {
  background-color: white;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  padding: 20px;
  margin-bottom: 30px;
  font-size: 15px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  align-items: flex-start;
}
    .categoria-export ul {
  text-align: left;
      background: #f5f5f5;
      padding: 10px;
      border-radius: 5px;
      list-style: none;
      padding-left: 20px;
    }
    .categoria-export ul li {
      position: relative;
      padding-left: 20px;
      margin-bottom: 8px;
    }
    .categoria-export p {
  text-align: left;
}

.categoria-export ul li::before {
      content: "\2022";
      position: absolute;
      left: 0;
      color: #555;
    }
    .categoria-export .image-columns {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }
    .categoria-export .image-columns img {
    width: calc(50% - 5px);
    height: auto;
    border-radius: 8px;
    object-fit: cover;
    aspect-ratio: 1 / 1;
  }
    @media (max-width: 600px) {
  .categoria-export .image-columns {
    flex-direction: row;
    flex-wrap: wrap;
  }
  .categoria-export .image-columns img {
    width: 100%;
  }
}
  .categoria-export .image-columns img {
    width: calc(50% - 5px);
  }
}
  .categoria-export .image-columns img {
    flex: 1 1 100%;
    width: 100%;
  }
}
    }
  
/* Botones modernos */
button {
  background-color: #2C666E;
  color: white;
  border: none;
  padding: 10px 18px;
  border-radius: 6px;
  font-size: 14px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}
button:hover {
  background-color: #1e474b;
}

/* Header m√°s elegante */
.header {
  font-family: 'Segoe UI', sans-serif;
  letter-spacing: 1px;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
}

/* Espaciado entre secciones */
.attribute-group {
  margin-bottom: 30px;
}

/* Tipograf√≠a m√°s sobria */
body {
  font-size: 14px;
  font-weight: 400;
}
::placeholder {
  font-style: italic;
  color: #aaa;
}

/* Redondear im√°genes cuadradas */
.categoria-export img {
  border-radius: 10px;
}

/* Tama√±o iconos diferenciadores */
.categoria-export .icono-diferenciador {
  width: 64px !important;
  height: 64px !important;
  object-fit: contain;
}

/* Responsive buttons */
@media (max-width: 480px) {
  .button-group {
    flex-direction: column;
  }
}
</style>

<style>
  body {
    font-family: 'Segoe UI', Roboto, sans-serif;
    background-color: #f4f6f8;
    color: #333;
  }
  .header {
    background-color: #003366;
    color: #fff;
    font-size: 26px;
    font-weight: 600;
    padding: 20px;
    border-bottom: 5px solid #0059b3;
  }
  button, .btn {
    background-color: #0059b3;
    color: #fff;
    border: none;
    padding: 10px 20px;
    margin: 5px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    transition: background-color 0.3s;
  }
  button:hover, .btn:hover {
    background-color: #0073e6;
  }
  input, select, textarea {
    border: 1px solid #ccc;
    border-radius: 6px;
    padding: 8px;
    font-size: 14px;
  }
  .categoria-export {
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    padding: 20px;
    margin-bottom: 30px;
  }
  .categoria-export h3 {
    color: #003366;
  }
  .categoria-export ul {
    background: #eef2f7;
    padding: 10px;
    border-radius: 6px;
    list-style: none;
    padding-left: 20px;
  }
  .categoria-export ul li {
    margin-bottom: 8px;
  }
</style>

</head>
<body>
<div class="header">Creador de Descripciones Largas</div>
<div class="container">
<div class="attribute-group">
<p>üìÖ <strong>Procesar Excel:</strong> Sube un archivo Excel con los productos para generar autom√°ticamente las fichas. Aseg√∫rate de que contenga los siguientes campos: <em>SKU, Nombre, Tipo, Marca, Beneficios, Informaci√≥n adicional, URL Imagen</em>.</p>
<p>üìÑ <strong>Descargar Plantilla:</strong> Puedes descargar una plantilla de ejemplo para completar correctamente.</p>
<p>üìù <strong>Formulario Unitario:</strong> Tambi√©n puedes ingresar productos de forma individual usando el formulario m√°s abajo.</p>
<p>üîµ <strong>Color del T√≠tulo:</strong> Solo se permiten los valores <em>Negro</em>, <em>Azul</em> o <em>Rosa</em> en este campo.</p>
</div>
<div class="attribute-group">
<label for="excelInput">üìÅ Selecciona tu archivo Excel:</label>
<input accept=".xlsx, .xls" id="excelInput" type="file"/>
<div class="button-group">
<button id="btnProcesar">üì• Procesar Excel</button>
<button id="btnPlantilla">üìÑ Descargar Plantilla</button>
<button id="btnExportar">‚¨áÔ∏è Exportar HTML a Excel</button>
<button id="btnLimpiar">üßπ Limpiar</button>
</div>
</div>
<hr style="border: none; border-top: 2px solid #ccc; margin: 40px 0 10px"/>
<h3 style="margin-bottom: 10px; font-size: 20px; color: #2c3e50">üìù Carga unitaria</h3>
<div class="attribute-group form-unitario-grid">
<div>
<label for="skuUnit">SKU (solo referencial)</label>
<input id="skuUnit" placeholder="Ej: 12345678" type="text"/>
</div>
<div>
<label for="nombreUnit"><span style="color:red">*</span> Nombre de Producto</label>
<input id="nombreUnit" placeholder="Ej: Labial Super Stay Matte Ink" type="text"/>
</div>
<div>
<label for="marcaUnit"><span style="color:red">*</span> Marca</label>
<input id="marcaUnit" placeholder="Ej: Maybelline" type="text"/>
</div>
<div>
<label for="tipoUnit">Tipo de Producto</label>
<input id="tipoUnit" placeholder="Ej: Labiales" type="text"/>
</div>
<div class="full-width">
<label for="beneficiosUnit">Beneficios (separados por coma):</label>
<input id="beneficiosUnit" placeholder="Ej: Larga duraci√≥n, No se transfiere, Alta pigmentaci√≥n" type="text"/>
</div>
<div class="full-width">
<label for="infoUnit">Informaci√≥n adicional:</label>
<input id="infoUnit" placeholder="Ej: Agita bien antes de usar. Aplica desde el centro hacia los extremos." type="text"/>
</div>
<div>
<label for="img1Unit">URL Imagen <span style="font-style: italic; color: #888">(Formato horizontal)</span>:</label>
<input id="img1Unit" placeholder="Ej: https://.../imagen1.jpg" type="text"/>
</div>
<div>
<label for="img2Unit">URL Imagen 2 <span style="font-style: italic; color: #888">(Formato cuadrado)</span>:</label>
<input id="img2Unit" placeholder="Ej: https://.../imagen2.jpg" type="text"/>
</div>
<div>
<label for="img3Unit">URL Imagen 3 <span style="font-style: italic; color: #888">(Formato cuadrado)</span>:</label>
<input id="img3Unit" placeholder="Ej: https://.../imagen3.jpg" type="text"/>
</div>
<div>
<label for="colorUnit">Color del T√≠tulo:</label>
<select id="colorUnit">
<option value="azul">Azul</option>
<option value="rosa">Rosa</option>
<option value="negro">Negro</option>
</select>
</div>
<div class="full-width">
<hr style="border: none; border-top: 1px solid #ccc; margin: 20px 0;"/>
<h4 style="font-size: 16px; color: #007bff; font-weight: normal; margin-bottom: 10px;">‚ú® Selecciona 1 o varios atributos diferenciadores</h4>
<div id="checkboxDiferenciadores" style="display: flex; flex-wrap: wrap; gap: 10px;">
<style>#checkboxDiferenciadores label { font-weight: normal; }</style>
<label><input type="checkbox" value="Cruelty Free"/> Cruelty Free</label>
<label><input type="checkbox" value="Libre de Pesticidas"/> Libre de Pesticidas</label>
<label><input type="checkbox" value="No Probado en Animales"/> No Probado en Animales</label>
<label><input type="checkbox" value="No Toxico"/> No Toxico</label>
<label><input type="checkbox" value="Probado Lab"/> Probado Lab</label>
<label><input type="checkbox" value="Sin Aceite"/> Sin Aceite</label>
<label><input type="checkbox" value="Sin Parabenos"/> Sin Parabenos</label>
<label><input type="checkbox" value="Sin Sulfatos"/> Sin Sulfatos</label>
<label><input type="checkbox" value="Vegano"/> Vegano</label>
</div>
</div>
</div>
<div class="full-width button-group">

<button id="btnAgregar">üëÅÔ∏è Previsualizar Descripci√≥n</button></div>
</div>
<div id="descripcionFinal" style="max-width:900px;margin:0 auto;padding:10px;"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
    const coloresPermitidos = { azul: "#007bff", rosa: "#e91e63", negro: "#000000" };
    let fichasGeneradas = [];

    function procesarExcel() {
      const input = document.getElementById("excelInput");
      const file = input.files[0];
      if (!file) return alert("Por favor selecciona un archivo Excel.");

      const reader = new FileReader();
      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: "array" });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const rows = XLSX.utils.sheet_to_json(sheet);
            // Marcar checkboxes seg√∫n diferenciales del primer producto
    const [
  sku, nombre, tipo, marca, beneficios, infoAdicional,
url1, url2, url3, color, dif1, dif2, dif3, dif4
] = jsonData[1] || [];


    const checkboxContainer = document.getElementById("checkboxDiferenciadores");
    const checkboxes = checkboxContainer.querySelectorAll("input[type='checkbox']");
    [ dif1, dif2, dif3, dif4 ].forEach(valor => {
      if (!valor) return;
      checkboxes.forEach(cb => {
        if (cb.value.trim().toLowerCase() === valor.trim().toLowerCase()) {
          cb.checked = true;
        }
      });
    });

        if (!rows.length) return alert("El archivo Excel est√° vac√≠o o mal estructurado.");

        rows.forEach(item => {
          const colorNombre = (item["Color del T√≠tulo"] || "").toLowerCase();
          const color = coloresPermitidos[colorNombre] || "#000000";

      const diferenciadores = Array.from(document.querySelectorAll("#checkboxDiferenciadores input:checked")).map(c => c.value);
      const iconosMap = {
        "Cruelty Free": "images/Contenido%20Fichas/Diferenciadores/icono-crueltyfree.png?$staticlink$",
        "Libre de Pesticidas": "images/Contenido%20Fichas/Diferenciadores/icono-libre-pesticidas.png?$staticlink$",
        "No Probado en Animales": "images/Contenido%20Fichas/Diferenciadores/icono-no-probado-animales.png?$staticlink$",
        "No Toxico": "images/Contenido%20Fichas/Diferenciadores/icono-no-toxico.png?$staticlink$",
        "Probado Lab": "images/Contenido%20Fichas/Diferenciadores/icono-probado-lab.png?$staticlink$",
        "Sin Aceite": "images/Contenido%20Fichas/Diferenciadores/icono-sin-aceite.png?$staticlink$",
        "Sin Parabenos": "images/Contenido%20Fichas/Diferenciadores/icono-sin-parabenos.png?$staticlink$",
        "Sin Sulfatos": "images/Contenido%20Fichas/Diferenciadores/icono-sin-sulfatos.png?$staticlink$",
        "Vegano": "images/Contenido%20Fichas/Diferenciadores/icono-vegano.png?$staticlink$"
      };
      const iconosHTML = diferenciadores.length > 0
        ? `<div style='display:flex;gap:10px;flex-wrap:wrap;'>${diferenciadores.map(d => `<img src='${iconosMap[d]}' alt='${d}' style='width:80px;height:80px;max-width:100%;height:auto;object-fit:contain;'>`).join("")}</div>`
        : "";

          const beneficiosHTML = item["Beneficios"]
  ? `<ul>${item["Beneficios"].split(",").map(b => {
      const [antes, despues] = b.split(":");
      return despues
        ? `<li><strong>${antes.trim()}:</strong> ${despues.trim()}</li>`
        : `<li>${b.trim()}</li>`;
    }).join("")}</ul>`
  : "";
          const imagenesHTML = `
            ${item["URL Imagen"] ? `<div class='image-main'><img src='${item["URL Imagen"]}'></div>` : ""}
            <div class='image-columns'>
              ${item["URL Imagen 2"] ? `<img src='${item["URL Imagen 2"]}'>` : ""}
              ${item["URL Imagen 3"] ? `<img src='${item["URL Imagen 3"]}'>` : ""}
            </div>`;
          const ficha = `
            <div class='categoria-export'>
              <h3 style='color:${color}'>${item["Nombre"] || ""} ${item["Marca"] || ""}</h3>
              ${beneficiosHTML}
          ${iconosHTML}
              <p>${item["Informaci√≥n adicional"] || ""}</p>
              ${imagenesHTML}
            </div>
          `;
          document.getElementById("descripcionFinal").innerHTML += ficha;
          fichasGeneradas.push({ sku: item["SKU"], html: ficha });
        });
        alert("‚úÖ Excel procesado correctamente");
      };
      reader.readAsArrayBuffer(file);
    }

    function descargarPlantilla() {
  const link = document.createElement('a');
  link.href = "plantilla_descripciones.xlsx"; // debe coincidir con el nombre del archivo subido
  link.download = "plantilla_descripciones.xlsx";
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  alert("üìÑ Plantilla descargada exitosamente");
}

    
function descargarExcel() {
  if (!fichasGeneradas.length) {
    alert("No hay fichas generadas para exportar.");
    return;
  }

  const data = fichasGeneradas.map(f => {
    const parser = new DOMParser();
    const doc = parser.parseFromString(f.html, 'text/html');
    const container = doc.querySelector('.categoria-export');

    container.setAttribute("style", "background-color:white;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.08);padding:20px;margin-bottom:30px;font-size:15px;display:flex;flex-direction:column;gap:10px;align-items:flex-start;");

    const ul = container.querySelector("ul");
    if (ul) ul.setAttribute("style", "text-align:left;background:#f5f5f5;padding:10px;border-radius:5px;list-style:none;padding-left:20px;margin:0;");

    const lis = container.querySelectorAll("ul li");
    lis.forEach(li => {
      li.setAttribute("style", "position:relative;padding-left:20px;margin-bottom:8px;");
      const texto = li.innerHTML;
      if (texto.includes(":")) {
        const [antes, despues] = texto.split(":");
        li.innerHTML = `<span style='position:absolute;left:0;color:#555;'>&bull;</span><strong>${antes.trim()}:</strong> ${despues.trim()}`;
      } else {
        li.innerHTML = `<span style='position:absolute;left:0;color:#555;'>&bull;</span>${texto.trim()}`;
      }
    });

    const p = container.querySelector("p");
    if (p) p.setAttribute("style", "text-align:left;margin:0;");

    const imgMain = container.querySelector(".image-main img");
    if (imgMain) {
      imgMain.setAttribute("style", "width:100%;max-width:600px;height:auto;display:block;margin:0 auto;");
    }

    const imageCols = container.querySelector(".image-columns");
    if (imageCols) {
      imageCols.removeAttribute("class");
      imageCols.setAttribute("style", "display:flex;flex-wrap:wrap;gap:10px;margin-top:15px;");
      const imgs = imageCols.querySelectorAll("img");
      imgs.forEach(img => {
        img.setAttribute("style", "width:calc(50% - 5px);max-width:100%;height:auto;border-radius:8px;object-fit:cover;aspect-ratio:1/1;");
      });
    }

    let htmlExportado = container.outerHTML.trim();
    htmlExportado = htmlExportado.replace(/"(.*?)"/g, "'$1'");

    return {
      SKU: f.sku || "",
      HTML: htmlExportado
    };
  });

  const ws = XLSX.utils.json_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Fichas");
  XLSX.writeFile(wb, "Fichas_Generadas.xlsx");
  alert("‚¨áÔ∏è Archivo Excel exportado exitosamente");
}


function limpiarTodo() {
  document.getElementById("excelInput").value = "";
  document.getElementById("skuUnit").value = "";
  document.getElementById("nombreUnit").value = "";
  document.getElementById("marcaUnit").value = "";
  document.getElementById("tipoUnit").value = "";
  document.getElementById("beneficiosUnit").value = "";
  document.getElementById("infoUnit").value = "";
  document.getElementById("img1Unit").value = "";
  document.getElementById("img2Unit").value = "";
  document.getElementById("img3Unit").value = "";
  document.getElementById("colorUnit").value = "azul";
  document.getElementById("descripcionFinal").innerHTML = "";

  // ‚úÖ Limpiar checkboxes
  const checkboxes = document.querySelectorAll('#checkboxDiferenciadores input[type="checkbox"]');
  checkboxes.forEach(cb => cb.checked = false);

  // ‚úÖ Reiniciar arrays
  fichasGeneradas = [];
  datosProcesados = [];

  alert("üßπ Formulario limpiado");
}

    function agregarUnitario() {
      const sku = document.getElementById("skuUnit").value.trim();
      const nombre = document.getElementById("nombreUnit").value.trim();
      const marca = document.getElementById("marcaUnit").value.trim();
      const tipo = document.getElementById("tipoUnit").value.trim();
      const beneficios = document.getElementById("beneficiosUnit").value.trim();
      const info = document.getElementById("infoUnit").value.trim();
      const img1 = document.getElementById("img1Unit").value.trim();
      const img2 = document.getElementById("img2Unit").value.trim();
      const img3 = document.getElementById("img3Unit").value.trim();
      const colorNombre = document.getElementById("colorUnit").value.toLowerCase();
      const color = coloresPermitidos[colorNombre] || "#000000";

      const diferenciadores = Array.from(document.querySelectorAll("#checkboxDiferenciadores input:checked")).map(c => c.value);
      const iconosMap = {
        "Cruelty Free": "images/Contenido%20Fichas/Diferenciadores/icono-crueltyfree.png?$staticlink$",
        "Libre de Pesticidas": "images/Contenido%20Fichas/Diferenciadores/icono-libre-pesticidas.png?$staticlink$",
        "No Probado en Animales": "images/Contenido%20Fichas/Diferenciadores/icono-no-probado-animales.png?$staticlink$",
        "No Toxico": "images/Contenido%20Fichas/Diferenciadores/icono-no-toxico.png?$staticlink$",
        "Probado Lab": "images/Contenido%20Fichas/Diferenciadores/icono-probado-lab.png?$staticlink$",
        "Sin Aceite": "images/Contenido%20Fichas/Diferenciadores/icono-sin-aceite.png?$staticlink$",
        "Sin Parabenos": "images/Contenido%20Fichas/Diferenciadores/icono-sin-parabenos.png?$staticlink$",
        "Sin Sulfatos": "images/Contenido%20Fichas/Diferenciadores/icono-sin-sulfatos.png?$staticlink$",
        "Vegano": "images/Contenido%20Fichas/Diferenciadores/icono-vegano.png?$staticlink$"
      };
      const iconosHTML = diferenciadores.length > 0
        ? `<div style='display:flex;gap:10px;flex-wrap:wrap;'>${diferenciadores.map(d => `<img src='${iconosMap[d]}' alt='${d}' style='width:80px;height:80px;max-width:100%;height:auto;object-fit:contain;'>`).join("")}</div>`
        : "";


      const beneficiosHTML = beneficios
  ? `<ul>${beneficios.split(",").map(b => {
      const [antes, despues] = b.split(":");
      return despues
        ? `<li><strong>${antes.trim()}:</strong> ${despues.trim()}</li>`
        : `<li>${b.trim()}</li>`;
    }).join("")}</ul>`
  : "";
      const imagenesHTML = `
        ${img1 ? `<div class='image-main'><img src='${img1}'></div>` : ""}
        <div class='image-columns'>
          ${img2 ? `<img src='${img2}'>` : ""}
          ${img3 ? `<img src='${img3}'>` : ""}
        </div>`;

      const ficha = `
        <div class='categoria-export'>
          <h3 style='color:${color}'>${nombre} ${marca}</h3>
          ${beneficiosHTML}
          ${iconosHTML}
          <p>${info}</p>
          ${imagenesHTML}
        </div>
      `;

      document.getElementById("descripcionFinal").innerHTML += ficha;
      fichasGeneradas.push({ sku, html: ficha });
    }

    document.getElementById("btnAgregar").addEventListener("click", agregarUnitario);
    document.getElementById("btnProcesar").addEventListener("click", procesarExcel);
    document.getElementById("btnPlantilla").addEventListener("click", descargarPlantilla);
    document.getElementById("btnExportar").addEventListener("click", descargarExcel);
    document.getElementById("btnLimpiar").addEventListener("click", limpiarTodo);
  </script>
<script>
  document.getElementById("btnPlantilla").addEventListener("click", function () {
    const url = "https://catalogo2025.github.io/creador_descripciones_largas/Plantilla_Fichas_Diferenciadores_y_Color_VALIDADO.xlsx";
    const a = document.createElement("a");
    a.href = url;
    a.download = "plantilla_descripciones.xlsx";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  });
</script>
<script>
  // Aqu√≠ van: colorMap, rutasIconos, datosProcesados, procesarExcel(), mostrarTablaDesdeExcel()

  const colorMap = {
    negro: "#000000",
    azul: "#007bff",
    rosa: "#e91e63"
  };

  const rutasIconos = {
    "Cruelty Free": "images/Contenido%20Fichas/Diferenciadores/icono-crueltyfree.png?$staticlink$",
    "Libre de Pesticidas": "images/Contenido%20Fichas/Diferenciadores/icono-libre-pesticidas.png",
    "No Probado en Animales": "images/Contenido%20Fichas/Diferenciadores/icono-no-probado-animales.png",
    "No Toxico": "images/Contenido%20Fichas/Diferenciadores/icono-no-toxico.png",
    "Probado Lab": "images/Contenido%20Fichas/Diferenciadores/icono-probado-lab.png",
    "Sin Aceite": "images/Contenido%20Fichas/Diferenciadores/icono-sin-aceite.png",
    "Sin Parabenos": "images/Contenido%20Fichas/Diferenciadores/icono-sin-parabenos.png",
    "Sin Sulfatos": "images/Contenido%20Fichas/Diferenciadores/icono-sin-sulfatos.png",
    "Vegano": "images/Contenido%20Fichas/Diferenciadores/icono-vegano.png"
  };

  let datosProcesados = [];

  function procesarExcel() {
    const fileInput = document.getElementById("excelInput");
    const file = fileInput.files[0];

    if (!file) {
      alert("Por favor selecciona un archivo Excel.");
      return;
    }

    const reader = new FileReader();
    reader.onload = function (e) {
      const data = new Uint8Array(e.target.result);
      const workbook = XLSX.read(data, { type: "array" });
      const firstSheet = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[firstSheet];
      const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
      datosProcesados = jsonData;
      alert("‚úÖ Archivo procesado correctamente. Ahora puedes presionar 'Ver Tabla'.");
    };
    reader.readAsArrayBuffer(file);
  }

  function mostrarTablaDesdeExcel() {
    const contenedor = document.getElementById("descripcionFinal");
    contenedor.innerHTML = "";

    datosProcesados.slice(1).forEach((fila) => {
      const [sku, nombre, tipo, marca, beneficios, infoAdicional, url1, url2, url3, color, dif1, dif2, dif3, dif4] = fila;

      const beneficiosLista = beneficios?.split(",").map(b => `<li>${b.trim()}</li>`).join("") || "";

      const iconos = [dif1, dif2, dif3, dif4].filter(Boolean).map(valor => {
        const src = rutasIconos[valor.trim()];
        return src ? `<img src="${src}" alt="${valor}" style="width:80px;height:80px;object-fit:contain;">` : '';
      }).join("");

      const html = `
          <div style='background:#eee;padding:5px 10px;border-radius:5px;font-size:13px;margin-bottom:5px;'>üì¶ SKU: ${sku}</div>
        <div class="categoria-export" style="background:white;padding:15px;border-radius:8px;margin-bottom:25px;font-size:15px;">
          <h3 style="color:${colorMap[color?.toLowerCase()] || '#000'}">${nombre || "Sin nombre"}</h3>
          <ul style="background:#f5f5f5;padding:10px;border-radius:5px;list-style:none;padding-left:20px;">
            ${beneficiosLista}
          </ul>
          
           <div style="margin-top:10px;display:flex;flex-wrap:wrap;gap:10px;">
            ${iconos}
          </div>
          
          <p>${infoAdicional || ''}</p>
          <div style="display:flex;flex-wrap:wrap;gap:10px;margin-top:10px;">
            ${url1 ? `<img src="${url1}" style="max-width:100%;height:auto;">` : ''}
            ${url2 ? `<img src="${url2}" style="width:48%;height:auto;">` : ''}
            ${url3 ? `<img src="${url3}" style="width:48%;height:auto;">` : ''}
          </div>
        </div>
      `;
      contenedor.innerHTML += html;
    fichasGeneradas.push({ sku: sku || '', html: html });
    });
  }

  // Asocia eventos con los botones
  document.getElementById("btnProcesar").addEventListener("click", procesarExcel);
  document.getElementById("btnAgregar").addEventListener("click", mostrarTablaDesdeExcel);
</script>
</body>
</html>
